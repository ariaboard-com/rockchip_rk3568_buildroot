From b6482f3f27f9e8c238bfbb6bc31ef28f82ada2f9 Mon Sep 17 00:00:00 2001
From: Jeffy Chen <jeffy.chen@rock-chips.com>
Date: Sat, 20 Mar 2021 10:38:06 +0800
Subject: [PATCH] HACK: pixman-renderer: Force clear with background

The background might have alpha channel.

Signed-off-by: Jeffy Chen <jeffy.chen@rock-chips.com>
---
 libweston/pixman-renderer.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/libweston/pixman-renderer.c b/libweston/pixman-renderer.c
index 5640c4e..eaa382e 100644
--- a/libweston/pixman-renderer.c
+++ b/libweston/pixman-renderer.c
@@ -379,6 +379,15 @@ repaint_region(struct weston_view *ev, struct weston_output *output,
 	pixman_image_t *mask_image;
 	pixman_color_t mask = { 0, };
 
+	/* HACK: Clear with background */
+	char label[512];
+	if (ev->surface && ev->surface->get_label &&
+	    ev->surface->get_label(ev->surface, label, sizeof(label)) > 0) {
+		if (!strncmp(label, "background", strlen("background"))) {
+			pixman_op = PIXMAN_OP_SRC;
+		}
+	}
+
 	if (po->shadow_image)
 		target_image = po->shadow_image;
 	else
-- 
2.20.1

